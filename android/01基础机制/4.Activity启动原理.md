### Activity启动流程

[TOC]

#### 1. 介绍

>  大致流程：Zygote fork APP进程->ActivityThread执行main方法(handler loop)->attach applicationThread->接收AMS消息->Activity显示。

- ActivityThread

  代表App的主线程，它是app的入口类，main函数被加载，执行loop循环。

  ```java
    public static void main(String[] args) {
          ......
          Looper.prepareMainLooper();
          ActivityThread thread = new ActivityThread();//实例化这个类
          thread.attach(false);//这个attach也很关键后面分析.
          if (sMainThreadHandler == null) {
              sMainThreadHandler = thread.getHandler();//很重要mainHandler用于处理UI线程的各种信息
          }
          ......
          Looper.loop();
          //可以看出来主线程也是在无限的循环的，异常退出循环的时候会报错.
          throw new RuntimeException("Main thread loop unexpectedly exited");
      }
  ```

  

- final H mH = new H();

  这个H是继承自Handler的,它是个私有的内部类，其实就是主线程的Handler，通过这个Handler就可以往主线程的消息队列发消息如：启动Activity、service，接收广播等等,很多重要的工作.

- ..

- ..

- ..

 